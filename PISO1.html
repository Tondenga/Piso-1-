<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tour Virtual - Piso 1</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #111;
    }
    #api-frame-wrapper {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div id="api-frame-wrapper">
    <iframe
      id="api-frame"
      allow="autoplay; fullscreen; xr-spatial-tracking"
      src="https://sketchfab.com/models/65a139a964894075b67e3c9a3886d85b/embed?autostart=1&ui_infos=0&ui_controls=0&ui_stop=0">
    </iframe>
  </div>

  <!-- Audio global (fuera del iframe) -->
  <audio id="audio" autoplay></audio>

  <!-- Sketchfab API -->
  <script src="https://static.sketchfab.com/api/sketchfab-viewer-1.12.1.js"></script>
  <script>
    const iframe = document.getElementById('api-frame');
    const client = new Sketchfab(iframe);
    const audio = document.getElementById('audio');

    const audiosPorAnotacion = {
      0: "audio/OnceUponaTime.mp3",
      1: "audio/Sans.mp3",
      2: "audio/Heartache.mp3",
      3: "audio/MEGALOVANIA.mp3"
    };

    client.init('65a139a964894075b67e3c9a3886d85b', {
      success: function(api) {
        api.start();

        api.addEventListener('viewerready', function() {
          console.log("Piso 1 cargado");

          api.addEventListener('annotationFocus', function(index) {
            console.log("Anotaci√≥n activada:", index);

            const ruta = audiosPorAnotacion[index];
            if (ruta) {
              audio.src = ruta;
              audio.play();
            } else {
              audio.pause();
              audio.removeAttribute('src');
            }
          });
        });
      },
      error: function() {
        console.error("No se pudo cargar el visor de Sketchfab");
      }
    });
  </script>
</body>
</html>
